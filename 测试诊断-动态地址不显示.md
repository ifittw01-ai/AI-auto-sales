# 🔍 动态地址不显示 - 问题诊断

## 症状
在 index.html 中看到的评估地点还是旧的静态选项，没有从 Google Sheet 动态加载。

---

## 🎯 最可能的原因

### ❌ 原因 1：直接在本地打开 HTML 文件（最常见）

**症状**：
- 浏览器地址栏显示：`file:///C:/Users/user/.../index.html`
- Console 显示 CORS 错误

**问题**：
当你直接双击打开 HTML 文件时，浏览器使用 `file://` 协议，这会导致：
- ❌ 无法访问 Google Apps Script API（CORS 限制）
- ❌ 无法加载动态数据
- ❌ 显示旧的静态选项

**解决方法**：
使用以下任一方式：

#### 方法 A：使用 GitHub Pages（推荐）
```
https://ifittw01-ai.github.io/AI-auto-sales/
```
等待 2-3 分钟让 GitHub Pages 部署完成

#### 方法 B：使用本地服务器
在项目目录运行：
```bash
# Python 3
python -m http.server 8000

# 然后访问
http://localhost:8000
```

---

### ❌ 原因 2：GitHub Pages 还没有部署完成

**症状**：
- 访问 GitHub Pages 看到的还是旧版
- 刚刚 push 代码不到 2 分钟

**解决方法**：
1. 前往 https://github.com/ifittw01-ai/AI-auto-sales/actions
2. 查看部署状态（应该有个绿色的勾）
3. 等待 2-3 分钟让部署完成
4. 强制刷新：`Ctrl + Shift + R`（清除缓存）

---

### ❌ 原因 3：浏览器缓存

**症状**：
- 网站已经部署
- 但看到的还是旧页面

**解决方法**：
按 `Ctrl + Shift + R` 强制刷新（Windows）
或 `Cmd + Shift + R`（Mac）

---

### ❌ 原因 4：Google Apps Script 没有更新

**症状**：
- Console 显示：`✅ 成功载入 0 个评估地点`
- 或显示错误信息

**解决方法**：
1. 打开 https://script.google.com
2. 确认已经复制 `google-apps-script-enhanced.js` 到 Code.gs
3. 确认已经选择「新版本」重新部署
4. 等待 1-2 分钟

---

## 🔬 详细诊断步骤

### 步骤 1：检查你的访问方式

打开浏览器，查看地址栏：

**❌ 错误的访问方式**（会导致无法加载动态数据）：
```
file:///C:/Users/user/OneDrive/桌面/realdemo/AI-auto-sales/index.html
```

**✅ 正确的访问方式**：
```
https://ifittw01-ai.github.io/AI-auto-sales/
```
或
```
http://localhost:8000/
```

---

### 步骤 2：打开开发者工具检查

1. 按 `F12` 打开开发者工具
2. 切换到「Console」标签
3. 刷新页面（F5）

**查看日志输出**：

#### 情况 A：看到这些日志 ✅
```
📍 正在載入評估地點選項...
✅ 成功載入 2 個評估地點
```
→ **动态加载成功！** 检查下拉选单是否有更新

#### 情况 B：看到 CORS 错误 ❌
```
Access to fetch at 'https://script.google.com/...' from origin 'null' 
has been blocked by CORS policy
```
→ **你是用 file:// 协议打开的！** 请使用 GitHub Pages 或本地服务器

#### 情况 C：看到 404 错误 ❌
```
GET https://script.google.com/...?action=getRegions 404 (Not Found)
```
→ **Google Apps Script URL 错误！** 检查部署 URL

#### 情况 D：看到空数组 ⚠️
```
📍 正在載入評估地點選項...
✅ 成功載入 0 個評估地點
⚠️ 載入評估地點失敗，使用預設選項
```
→ **Google Sheet 设置有问题！** 检查工作表名称和数据

---

### 步骤 3：检查网络请求

在开发者工具中：
1. 切换到「Network」标签
2. 刷新页面
3. 查找 `getRegions` 请求

**点击这个请求，查看响应**：

#### 正常响应 ✅
```json
{
  "success": true,
  "regions": [
    {
      "id": "1",
      "text": "11/3 星期一...",
      ...
    }
  ],
  "count": 2
}
```

#### 异常响应 ❌
- 如果看到 HTML 页面：Google Apps Script 部署有问题
- 如果看到空数组：Google Sheet 工作表没有数据
- 如果看到错误信息：查看错误详情

---

## 🚀 快速解决方案

### 方案 1：使用 GitHub Pages（最简单）

1. **等待部署完成**（2-3 分钟）
   ```
   https://github.com/ifittw01-ai/AI-auto-sales/actions
   ```

2. **访问网站**
   ```
   https://ifittw01-ai.github.io/AI-auto-sales/
   ```

3. **强制刷新**
   ```
   Ctrl + Shift + R
   ```

4. **按 F12 查看 Console**
   ```
   应该看到：✅ 成功載入 X 個評估地點
   ```

---

### 方案 2：使用本地服务器测试

如果想在本地测试，运行：

```bash
# 在项目目录执行
python -m http.server 8000
```

然后访问：
```
http://localhost:8000/
```

---

## 📝 检查清单

在报告问题前，请确认：

- [ ] 我使用的是 **GitHub Pages URL** 或 **本地服务器**（不是直接打开文件）
- [ ] 我已经 **强制刷新** 浏览器（Ctrl + Shift + R）
- [ ] GitHub Actions 显示 **部署成功**（绿色勾）
- [ ] 我已经打开 **F12 开发者工具**
- [ ] 我查看了 **Console** 的日志输出
- [ ] 我查看了 **Network** 的请求响应

---

## 💡 提供以下信息以便诊断

如果还是不行，请提供：

1. **你的访问方式**：
   - [ ] 直接双击打开 HTML 文件
   - [ ] 访问 GitHub Pages
   - [ ] 使用本地服务器

2. **浏览器地址栏显示**：
   ```
   （粘贴你的 URL）
   ```

3. **Console 日志**：
   ```
   （粘贴 Console 中的输出）
   ```

4. **Network 响应**：
   ```
   （粘贴 getRegions 请求的响应）
   ```

---

## 🎯 预期的正确流程

1. ✅ 访问 `https://ifittw01-ai.github.io/AI-auto-sales/`
2. ✅ 页面加载，评估地区显示「载入中...」
3. ✅ Console 显示：`📍 正在載入評估地點選項...`
4. ✅ 1-2 秒后 Console 显示：`✅ 成功載入 2 個評估地點`
5. ✅ 下拉选单显示从 Google Sheet 加载的选项
6. ✅ 如果有容量限制，显示剩余名额

